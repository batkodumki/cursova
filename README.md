# Метод експертних попарних порівнянь з уточненням ступеня переваги

Реалізація адаптивного методу експертних оцінок для підтримки прийняття рішень.

## Опис

Система реалізує метод попарних порівнянь з можливістю адаптивного вибору шкал оцінювання для кожного окремого порівняння. Базується на наукових публікаціях:

- **РЗОД-2011-2.pdf**: Концепція адаптивних систем підтримки прийняття рішень
- **РЗОД-2011-3.pdf**: Вибір шкал експертного оцінювання (Сааті-5, Сааті-9, збалансована, степенева)
- **РЗОД-2011-4.pdf**: Уніфікація оцінок, спектральний показник узгодженості, агрегація
- **РЗОД-2012-1.pdf**: Практичні рекомендації та приклади

## Основні можливості

### 1. Адаптивний вибір шкал
- Порядкова шкала (2 градації)
- Фундаментальна шкала Сааті (5 або 9 градацій)
- Збалансована шкала
- Степенева шкала
- Шкали Ма-Жена та Донегана-Додда-МакМастера

Експерт може обирати різні шкали для **кожного окремого порівняння**.

### 2. Уніфікація до єдиної кардинальної шкали
Формула центрів інтервалів: **M_i^n = l + (i - 1/2) × (p - l) / n**, де:
- l = 1.5 (нижня межа)
- p = 9.5 (верхня межа)
- n = кількість градацій шкали
- i = номер градації

### 3. Робота з неповними матрицями
- Перевірка зв'язності графу порівнянь
- Автоматичне заповнення через транзитивність
- Підтримка мінімально необхідних порівнянь

### 4. Оцінка узгодженості
- Розрахунок максимального власного значення **λ_max**
- Індекс узгодженості **CI = (λ_max - n) / (n - 1)**
- Відношення узгодженості **CR = CI / RI**
- Критерій: **CR < 0.10** для прийнятної узгодженості

### 5. Зворотний зв'язок з експертом
- Генерація рекомендацій для неузгоджених оцінок
- Побудова ідеальної узгодженої МПП
- Визначення порівнянь з найбільшим відхиленням

### 6. Групова агрегація
- Зважування за інформативністю шкали: **I = log₂ N** (формула Хартлі)
- Зважування за коефіцієнтами компетентності експертів
- Геометричне середнє зважене для комбінування оцінок

### 7. Розрахунок вагових коефіцієнтів
- Метод власного вектора
- Метод геометричного середнього рядків
- Ранжування альтернатив

## Структура проекту

```
cursova/
├── scales.py              # Визначення шкал, уніфікація
├── pcm.py                 # Матриці попарних порівнянь (МПП)
├── consistency.py         # Оцінка узгодженості, рекомендації
├── aggregate.py           # Групова агрегація
├── main.py                # CLI інтерфейс
├── input_example.json     # Приклад вхідних даних
├── requirements.txt       # Залежності
└── README.md              # Документація
```

## Встановлення

### Вимоги
- Python 3.10 або вище
- pip

### Крок 1: Клонування репозиторію
```bash
git clone <repository_url>
cd cursova
```

### Крок 2: Встановлення залежностей
```bash
pip install -r requirements.txt
```

## Використання

### Запуск з прикладом
```bash
python main.py --input input_example.json --out out/
```

### Формат вхідних даних (JSON)

```json
{
  "alternatives": ["Проект_A", "Проект_B", "Проект_C", "Проект_D"],
  "experts": [
    {
      "expert_id": "Експерт_1",
      "judgments": [
        {
          "alt_i": "Проект_A",
          "alt_j": "Проект_B",
          "value": 5.0,
          "scale_type": "saaty_9",
          "n_gradations": 9
        }
      ]
    }
  ],
  "competence_coefficients": {
    "Експерт_1": 0.85,
    "Експерт_2": 0.60
  }
}
```

#### Параметри оцінок
- `alt_i`, `alt_j`: Назви альтернатив для порівняння
- `value`: Значення на вихідній шкалі
- `scale_type`: Тип шкали
  - `"ordinal"` - порядкова (2 градації)
  - `"saaty_5"` - Сааті-5 (3-5 градацій)
  - `"saaty_9"` - Сааті-9 (3-9 градацій)
  - `"balanced"` - збалансована (3-9 градацій)
  - `"power"` - степенева (3-9 градацій)
  - `"ma_zheng"` - Ма-Жена (3-9 градацій)
  - `"donegan"` - Донегана (3-9 градацій)
- `n_gradations`: Кількість градацій (3-9, залежить від типу шкали)

### Вихідні файли

Після виконання в директорії `out/` створюються:

#### 1. `weights.csv`
Вагові коефіцієнти та ранжування альтернатив:
```csv
alternative,weight,rank
Проект_A,0.5123,1
Проект_B,0.2789,2
...
```

#### 2. `consistency.json`
Звіт про узгодженість:
```json
{
  "consistency_analysis": {
    "lambda_max": 4.1234,
    "CI": 0.0411,
    "CR": 0.0457,
    "is_consistent": true
  },
  "aggregated_matrix": [[1, 3, 5, 7], ...]
}
```

#### 3. `suggestions.json`
Рекомендації для покращення узгодженості (якщо CR ≥ 0.10):
```json
[
  {
    "comparison": "Проект_A vs Проект_B",
    "current_value": 3.0,
    "suggested_value": 4.2,
    "deviation_percent": 28.5,
    "message": "Рекомендується переглянути..."
  }
]
```

#### 4. `scale_transformations.json`
Журнал трансформацій шкал:
```json
[
  {
    "expert_id": "Експерт_1",
    "comparison": "Проект_A vs Проект_B",
    "original_scale": "saaty_9",
    "n_gradations": 9,
    "original_value": 5.0,
    "unified_value": 5,
    "informativeness": 3.169925
  }
]
```

## Приклад використання

### Вхідні дані
4 альтернативи (проекти), 2 експерти:
- **Експерт_1**: компетентність 0.85, шкала Сааті-9 (I ≈ 3.17 біт)
- **Експерт_2**: компетентність 0.60, шкала Сааті-5 (I ≈ 2.32 біт)

### Процес обробки
1. Побудова МПП для кожного експерта
2. Уніфікація оцінок до шкали 1-9
3. Заповнення неповних МПП (якщо потрібно)
4. Оцінка узгодженості (λ_max, CI, CR)
5. Агрегація з вагами:
   - Експерт_1: 3.17 × 0.85 ≈ 2.69
   - Експерт_2: 2.32 × 0.60 ≈ 1.39
6. Розрахунок вагових коефіцієнтів
7. Ранжування альтернатив

### Очікувані результати
- Агрегована МПП з узгодженістю CR < 0.10
- Вагові коефіцієнти для 4 альтернатив
- Рекомендації для покращення (якщо потрібно)

## Модулі та API

### `scales.py`
- `get_scale_values(scale_type, n_gradations)` - значення шкали
- `unify_to_cardinal(scale_type, n_gradations, grade_index)` - уніфікація
- `calculate_informativeness(n_gradations)` - інформативність I = log₂ N
- `unify_judgment(scale_type, n_gradations, value)` - уніфікація оцінки

### `pcm.py`
- `PairwiseComparisonMatrix` - клас для МПП
- `add_judgment(alt_i, alt_j, value, scale_type, n_gradations)` - додати оцінку
- `fill_transitive()` - заповнити через транзитивність
- `check_connectivity()` - перевірка зв'язності

### `consistency.py`
- `consistency_spectral(matrix)` - спектральний аналіз узгодженості
- `calculate_weights_eigenvector(matrix)` - ваги (власний вектор)
- `calculate_weights_geometric_mean(matrix)` - ваги (геометричне середнє)
- `ideal_pcm(weights)` - ідеальна узгоджена МПП
- `generate_revision_suggestions(matrix, alternatives)` - рекомендації
- `rank_weights(weights, alternatives)` - ранжування

### `aggregate.py`
- `group_aggregate(pcm_list, competence_coefficients)` - групова агрегація
- `calculate_expert_weights(pcm_list, competence_coefficients)` - ваги експертів
- `aggregate_with_statistics(pcm_list, competence_coefficients)` - агрегація зі статистикою

## Тестування

Модулі містять doctest приклади. Запуск тестів:

```bash
python -m doctest scales.py -v
python -m doctest pcm.py -v
python -m doctest consistency.py -v
python -m doctest aggregate.py -v
```

Демонстрація роботи модулів:

```bash
python scales.py
python pcm.py
python consistency.py
python aggregate.py
```

## Науковий фундамент

### Формула уніфікації (РЗОД-2011-4.pdf)
M_i^n = 1.5 + (i - 0.5) × 8 / n

### Інформативність шкали (РЗОД-2011-2.pdf)
I = log₂ N (формула Хартлі)

### Спектральний показник узгодженості (РЗОД-2011-4.pdf)
- λ_max - максимальне власне значення
- CI = (λ_max - n) / (n - 1)
- CR = CI / RI

### Вага експертної оцінки (РЗОД-2011-4.pdf)
w = I × c_l = log₂(N) × c_l

де:
- I - інформативність шкали
- c_l - коефіцієнт компетентності експерта

### Геометричне середнє зважене (РЗОД-2012-1.pdf)
GM = (∏ v_i^w_i)^(1/∑w_i)

## Автор

Курсова робота з теми: "Метод експертних попарних порівнянь з уточненням ступеня переваги"

## Ліцензія

Для навчальних цілей
